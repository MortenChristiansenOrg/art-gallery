id: artwork-management
title: Artwork Management
tags: [admin, crud, content, core]
status: implemented

description: |
  Admin can create, edit, delete, and reorder artworks.
  Includes image upload (single or bulk), metadata editing, and publish control.
  Bulk upload: multi-select images, shared metadata applies to all, per-image title editing.

implementation:
  - src/pages/Admin.tsx:10#Admin
  - src/components/admin/ArtworkForm.tsx:56#ArtworkForm
  - convex/artworks.ts:85#create
  - convex/artworks.ts:111#update
  - convex/artworks.ts:157#remove
  - convex/artworks.ts:175#reorder
  - convex/files.ts#generateUploadUrl

verification:
  unit:
    - path: src/components/admin/__tests__/ArtworkForm.test.tsx
      status: implemented
  e2e:
    - path: e2e/admin.spec.ts#artwork-crud
      status: implemented
    - path: e2e/admin.spec.ts#bulk-upload
      status: implemented
    - path: e2e/admin.spec.ts#artwork-reordering
      status: implemented

flows:
  create-artwork-bulk-filepicker:
    - Admin selects a collection from filter dropdown (default collection pre-selected)
    - Admin clicks "Add Artwork" button
    - Form modal opens (no collection dropdown - inherits from filter)
    - Admin clicks file input to open file picker
    - Admin selects multiple images (multi-select enabled)
    - Thumbnail previews appear for each selected image with editable title field
    - Titles default to filename without extension
    - Admin fills shared metadata (year, medium, dimensions, description)
    - Admin toggles published status (applies to all)
    - Admin saves
    - All images uploaded sequentially with progress indicator
    - New artworks added to selected collection, appear in admin list
    - Modal closes on completion

  create-artwork-bulk-dragdrop:
    - Admin selects a collection from filter dropdown (default collection pre-selected)
    - Admin clicks "Add Artwork" button
    - Form modal opens (no collection dropdown - inherits from filter)
    - Admin drags image files from file explorer onto drop zone
    - Thumbnail previews appear for each dropped image with editable title field
    - Titles default to filename without extension
    - Admin fills shared metadata (year, medium, dimensions, description)
    - Admin toggles published status (applies to all)
    - Admin saves
    - All images uploaded sequentially with progress indicator
    - New artworks added to selected collection, appear in admin list
    - Modal closes on completion

  create-artwork-single:
    - Identical to bulk flow but with single image selection

  edit-artwork:
    - Admin clicks edit button on artwork
    - Form modal opens with existing data
    - Admin modifies fields
    - Admin saves changes
    - List updates with new data

  delete-artwork:
    - Admin clicks delete button
    - Confirmation dialog shown
    - On confirm, artwork removed
    - List updates

  reorder-artworks:
    - Admin views artwork list filtered by selected collection
    - Admin drags artwork item to new position in list
    - Visual feedback shows drop target location
    - On drop, new order saved automatically to backend
    - Order persists on page reload
    - Reorder affects order within selected collection only

interactions:
  - type: click
    element: add-artwork-button
    action: Opens create form modal
  - type: change
    element: file-input
    action: Opens file picker with multi-select enabled
  - type: drop
    element: drop-zone
    action: Accepts dragged image files, adds to selection
  - type: change
    element: title-input-[index]
    action: Updates title for specific image in batch
  - type: click
    element: remove-image-button
    action: Removes image from batch before upload
  - type: click
    element: edit-button
    action: Opens edit form modal
  - type: click
    element: delete-button
    action: Shows confirmation dialog
  - type: drag
    element: artwork-row
    action: Reorders artwork in list
  - type: change
    element: published-toggle
    action: Toggles artwork visibility

requirements:
  collection-filtering:
    - Admin always views artworks filtered by collection (no "All Artworks" option)
    - Default collection selected on page load (first collection in list)
    - Collection selector dropdown shows all available collections
    - Changing collection filter updates artwork list immediately

  artwork-form-collection:
    - Collection field NOT shown in add/edit artwork dialog
    - New artworks inherit collection from currently selected filter
    - ArtworkForm receives collectionId as prop from parent
    - Editing artwork preserves existing collection unless filter changes

  file-input:
    - Add `multiple` attribute to input element
    - Show list of selected files below input
    - Support drag-and-drop onto drop zone area

  image-list:
    - Display each selected file as a row
    - Show thumbnail preview for each image
    - Editable title input per file
    - Remove button per file

  progress-indicator:
    - Show upload progress when saving multiple files
    - Display "Uploading 2 of 5..." or similar

  large-file-handling:
    - Images can be 20-30MB each
    - Generate thumbnails client-side using canvas downscaling (avoid loading full-res into DOM)
    - Use URL.createObjectURL for efficient memory handling
    - Revoke object URLs when images removed or modal closed
    - Consider chunked upload for very large files if needed

  constraints:
    - Title field required for each image (pre-filled from filename)
    - Image file required for create (enforced by selection)
    - Shared fields optional
    - Sequential upload to avoid overwhelming server
    - Error on one file should not stop others (continue and report failures at end)
    - Max 50 images at once

  visibility-gating:
    - Artworks not visible to public until thumbnail and DZI generation complete
    - Processing status tracked per artwork: pending | processing | ready | failed
    - Admin list shows processing status badge for each artwork
    - Published toggle only affects visibility after processing complete

  artwork-reordering:
    - Drag-and-drop reordering of artwork items in admin list
    - Works within currently selected collection only
    - Visual drag handle or entire row draggable
    - Drop indicator shows target position during drag
    - Auto-save on drop (no manual save button needed)
    - Optimistic UI update with rollback on error
    - Order stored as numeric `displayOrder` field on artwork
